#include <reg51.h>

#define IR_SENSOR P1_0   // IR sensor connected to P1.0
#define SERVO_PIN P2_0   // Servo motor connected to P2.0

void generate_pwm(unsigned int pulse_width) {
    unsigned int i;
    for (i = 0; i < 1000; i++) {
        SERVO_PIN = 1;  // Start pulse
        delay(pulse_width);
        SERVO_PIN = 0;  // End pulse
        delay(2000 - pulse_width);
    }
}

void delay(unsigned int time) {
    unsigned int i, j;
    for (i = 0; i < time; i++) {
        for (j = 0; j < 1275; j++) {}
    }
}

void open_door() {
    generate_pwm(120);  // Example: 120 ms for 90 degrees
}

void close_door() {
    generate_pwm(60);  // Example: 60 ms for 0 degrees
}

void main() {
    while (1) {
        if (IR_SENSOR == 0) {  // Person detected (active low)
            open_door();
            delay(5000);  // Keep door open for 5 seconds
            close_door();
        } else {
            close_door();  // Ensure door stays closed when no person is detected
        }
    }
}
